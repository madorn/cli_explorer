<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Web Explorer for OpenStack Command Line (CLI) Clients">
    <meta name="author" content="Ronald Bradford">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <link rel="icon" href="favicon.ico" type="image/x-icon">

    <title>OpenStack CLI Explorer</title>

    <!-- CDN
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    -->
    <link href="m/c/bootstrap.min.css" rel="stylesheet">
    <link href="m/c/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="m/c/styles.css"  rel="stylesheet" type="text/css">
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<body>

  <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation"> <!-- Navigation -->
    <div class="container-fluid">
      <!-- Brand and toggle get grouped for better mobile display -->
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.htm">CLI Explorer</a>
      </div>
      <!-- Collect the nav links, forms, and other content for toggling -->
      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
        <ul class="nav navbar-nav navbar-right">
          <li role="presentation"> <a class="notloggedin explorer">Explorer</a> </li>
          <li class="dropdown">
            <a href="#tools" class="dropdown-toggle" data-toggle="dropdown">CLI Tools <b class="caret"></b></a>
            <ul class="dropdown-menu">
               <li role="presentation"> <a href="#">OpenStackClient</a> </li>
               <li role="presentation" class="disabled"> <a href="#">Nova Client</a> </li>
               <li role="presentation" class="disabled"> <a href="#">Keystone Client</a> </li>
               <li role="presentation" class="disabled"> <a href="#">Glance Client</a> </li>
             </ul>
          </li>
          <li role="presentation"> <a data-toggle="modal" data-target="#help_page" href="#">Help</a> </li>
        </ul>
      </div> <!-- /.navbar-collapse -->
    </div> <!-- /.container -->
  </nav>

  <div class="modal fade bs-example-modal-lg" id="help_page" tabindex="-1" role="dialog" aria-labelledby="helpLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="helpLabel">OpenStack CLI Explorer Help</h4>
        </div>
        <div class="modal-body">
          <p>
            This tool is designed to assist users in becoming familiar with the various Command Line Interface (CLI) tools that exist with OpenStack. These tools include:
            <ul>
              <li>OpenStackClient (OSC), aka <code>openstack</code></li>
              <li>Nova compute client, aka <code>nova</code></li>
              <li>Glance image client, aka <code>glance</code></li>
              <li>Keystone identity client, aka <code>keystone</code></li>
            </ul>
          </p>
          <h2>OpenStackClient</h2>
          <p>
          The <b>CLI Explorer</b> for the <b>OpenStackClient</b> helps the end user with the scope of syntax options by breaking these into several arbitary categories. These categories are used simply to help in education.  They also are organized in respect to the general order of arguments. Arguments are broken down into these categories.:
          <ul>
            <li>Authentication</li>
            <li>Logging</li>
            <li>Arguments</li>
            <li>Output Format</li>
            <li>Options</li>
          </ul>
           </p>
          <pre>
$ openstack [ --os-username=&lt;user> ...] [ -q | -v | ...] [help] image list [ -f json ...   ] 
            [ Authentication          ] [ Logging      ] [               ] [ Output Format ] [Options]</pre>
          <p>
          </p>
          <h3>Authentication</h3>
          <p>
            The <button class="btn">Authentication</button> view enables you to define the authentication needed for your <b>openstack</b> command.  
            To assist in learning the wealth of authentication options, these are further broken down into Beginner and Expert options.
          </p>
          <p>The <b>Authentication</b> options also enable you to test the Public Identity URL, and the username,password and project values to ensure these are valid.</p>
          </p>
          <h3>Logging</h3>
          <p>The <button class="btn">Logging</button> view enables you to define the verbosity of the output that is generated for the <b>openstack</b> command.
          </p>
          <h3>Arguments</h3>
          <p>
          This is the required <b>command</b> and <b>option</b> arguments used with <b>openstack</b>. It is possible with the use of system environment variables for authentication to require no other arguments to produce output.  This section also includes the optional <b>help</b> prefix that provides detailed help information including the various detailed options that can be used.
          </p>
          <h3>Output Format</h3>
          <p>The <button class="btn">Output Format</button> view enables you to specify various formatting options that the <b>openstack</b> client can return.</p>
          <h3>Options</h3>
          <p>Finally, it is possible to specify addition options that are applicable to the specific <b>command</b> and <b>action</b> you have requested.</p>

          <h2>Messages</h2>
          <p>When running a constructed command you may receive the following messages. </p>
          <div class="alert alert-success">Successfully ran command.</div>
          <p>This message indicate you have run a command and that the Output (stdout) and Errors (stderr) will be present.</p>
          <div class="alert alert-warning">You need to specify a command.You need to specify an action.</div>
          <p>In order to use <button class="btn btn-success">Run</button> you need to specify <select><option>Command</option></select> and <select><option>Action</option></select> values.</p>
          <div class="alert alert-danger">Error executing the command with web API.</div>
          <p>This message is because the Flask api.py web container that processes the request when you click <b>Run</b> is not running.</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <section id="authentication_page" style="display:none">
    <div class="container-fluid">
      <fieldset>
        <legend>Authentication</legend>
        <div id="msg2" class="alert alert-dismissible" role="alert" style="display:none">
          <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <span id="msg2-text"></span>
        </div> <! -- #msg2 -->
        <form class="form-inline" method="POST">
          <div class="row" style="margin-top:40px">
          <div class="col-md-12">
          <div class="form-group">
            <label for="os-auth-url">Identity Public URL</label>
            <input name="os-auth-url" class="form-control" value="http://localhost:5000/v2.0/" style="width:250px"></input>
          </div> <!-- form-group -->
          <div class="form-group">
            <button class="btn btn-primary test">Test URL</button>
          </div> <!-- form-group -->
          </div> <!-- col -->
          </div> <!-- row -->

          <div class="row" style="margin-top:40px">
          <div class="col-md-12">
          <div class="form-group">
            <label for="os-username">Username</label>
            <input name="os-username" class="form-control" value="admin"></input>
          </div> <!-- form-group -->
          <div class="form-group">
            <label for="os-password">Password</label>
            <input name="os-password" class="form-control" value="passwd"></input>
          </div> <!-- form-group -->
          <div class="form-group">
            <label for="os-project-name">Project Name</label>
            <input name="os-project-name" class="form-control" value="admin"></input>
          </div> <!-- form-group -->
          <div class="form-group">
            <button class="btn btn-primary test">Test Values</button>
            <button class="btn btn-success save">Save</button>
            <button class="btn btn-warning cancel" style="float:right">Cancel</button>
          </div> <!-- form-group -->
          </div> <!-- col -->
          </div> <!-- row -->
        </form>
      </fieldset>
    </div> <!-- container -->
  </section> <!-- login_page -->

  <section id="logging_page" style="display:none">
    <div class="container-fluid">
      <fieldset>
        <legend>Logging</legend>
        <form class="form-inline" method="POST">
          <div class="form-group">
            <select name="logging" class="form-control">
              <option value="">Default</option>
              <option value="-q">Quiet (-q)</option>
              <option value="-v">Verbose (-v)</option>
              <option value="--debug">Debug (--debug)</option>
              <option value="--timing">Timing (--timing)</option>
              <option value="--log-file">Log File (--log-file)</option>
            </select>
          </div> <!-- form-group -->
          <div class="form-group">
            <button class="btn btn-success save">Save</button>
            <button class="btn btn-warning cancel" style="float:right">Cancel</button>
          </div> <!-- form-group -->
        </form>
      </fieldset>
     </div> <!-- container -->
  </section> <!-- logging_page -->

  <section id="format_page" style="display:none">
    <div class="container-fluid">
      <fieldset>
        <legend>Output Format</legend>
        <form class="form-inline" method="POST">
          <div class="form-group">
            <label for="long">Long Format</label>
            <input name="long" type="checkbox" class="form-control" value="--long"></input>
          </div>
          <div class="form-group">
            <label for="format">Display Format</label>
            <select name="format" class="form-control">
              <option value=""></option>
              <option value="-f table">Table (Default)</option>
              <option value="-f csv">CSV (-f csv)</option>
              <option value="-f json">JSON (-f json)</option>
              <option value="-f html">HTML (-f html)</option>
              <option value="-f yaml">YAML (-f yaml)</option>
              <option value="-f shell">Shell (-f shell)</option>
            </select>
          </div> <!-- form-group -->
          <div class="form-group">
            <label for="prefix">Shell Prefix</label>
            <input name="prefix" class="form-control" value=""></input>
          </div> <!-- form-group -->
          <div class="form-group">
            <button class="btn btn-success save">Save</button>
            <button class="btn btn-warning cancel" style="float:right">Cancel</button>
          </div> <!-- col -->
        </form>
      </fieldset>
    </div> <!-- container -->
  </section> <!-- format_page -->

  <section id="explorer_page" style="display:none">
    <div class="container-fluid">
      <fieldset>
        <legend>OpenStackClient</legend>
        <form class="form-inline" method="POST">
          <h2>Command Line Options</h2>
          <div class="row" style="margin-top:40px">
            <div class="col-md-12">
              <div id="msg" class="alert alert-dismissible" role="alert" style="display:none">
              <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
              <span id="msg-text"></span>
              </div> <! -- #msg -->
            </div> <!-- col -->
            <div class="col-md-12">
              <button class="btn authentication">Authentication</button>
              <button class="btn logging">Logging</button>
              <div class="form-group">
                <label for="help">Help</label>
                <input name="help" type="checkbox" class="form-control" value="help"></input>
              </div>
              <div class="form-group">
                <label for="command"></label>
                <select name="command" class="form-control">
                <option value="">Command</option>
                <optgroup label="Compute">
                  <option>image</option>
                  <option>flavor</option>
                  <option>server</option>
                  <option>console</option>
                  <option>ip fixed</option>
                  <option>ip floating</option>
                  <option>container</option>
                </optgroup>
                <optgroup label="Compute Security">
                  <option>keypair</option>
                  <option>security group</option>
                  <option>security group rule</option>
                  <option>ec2 credentials</option>
                </optgroup>
                <optgroup label="Storage">
                  <option>volume</option>
                  <option>volume type</option>
                  <option>snapshot</option>
                  <option>object</option>
                  <option>backup</option>
                </optgroup>
                <optgroup label="Identity">
                  <option>user</option>
                  <option>role</option>
                  <option>project</option>
                  <option>usage</option>
                  <option>quota</option>
                </optgroup>
                <optgroup label="Information">
                  <option>catalog</option>
                  <option>command</option>
                  <option>help</option>
                  <option>complete</option>
                  <option>extension</option>
                  <option>module</option>
                </optgroup>
                <optgroup label="Infrastructure">
                  <option>hypervisor</option>
                  <option>host</option>
                  <option>endpoint</option>
                  <option>token</option>
                  <option>availability zone</option>
                  <option>aggregate</option>
                  <option>limits</option>
                  <option>network</option>
                  <option>service</option>
                </optgroup>
                </select>
              </div> <!-- form-group -->
    
              <div class="form-group">
                <label for="action"></label>
                <select name="action" class="form-control">
                  <option value="">Action</option>
                  <optgroup label="Common">
                    <option>list</option>
                    <option>show</option>
                    <option>create</option>
                    <option>delete</option>
                    <option>set</option>
                    <option>unset</option>
                    <option>add</option>
                    <option>remove</option>
                    <option>save</option>
                  </optgroup>
                  <optgroup label="Unique">
                    <option value'log show'>log show (console)</option>
                    <option value'url show'>url show (console)</option>
                    <option value'pool list'>pool list (ip floating)</option>
                    <option value'role list'>role list (user)</option>
                    <option value'stats show'>stats show (hypervisor)</option>
                    <option value'issue'>issue (token)</option>
                    <option value'revoke'>revoke (token)</option>
                    <option value'add security group'>add security group (server)</option>
                    <option value'add volume'>add volume (server)</option>
                    <option value'remove security group'>remove security group (server)</option>
                    <option value'remove security group'>remove volume (server)</option>
                    <option value'image create'>image create (server)</option>
                    <option value'pause'>pause (server)</option>
                    <option value'reboot'>reboot (server)</option>
                    <option value'rebuild'>rebuild (server)</option>
                    <option value'rescue'>rescue (server)</option>
                    <option value'resize'>resize (server)</option>
                    <option value'resume'>resume (server)</option>
                    <option value'suspend'>suspend (server)</option>
                    <option value'unlock'>unlock (server)</option>
                    <option value'unpause'>unpause (server)</option>
                    <option value'unrescue'>unrescue (server)</option>
                    <option value'add host'>add host (aggregate)</option>
                    <option value'remove host'>remove host (aggregate)</option>
                  </optgroup>
                </select>
              </div> <!-- form-group -->
            <button class="btn format">Output Format</button>
            <div class="form-group">
              <label for="options">options</label>
              <input name="options" class="form-control" value=""></input>
            </div> <!-- form-group -->
            <button class="btn btn-success run">Run</button>
            <button class="btn btn-warning clear" style="float:right">Clear</button>
          </div> <!-- col -->
        </div> <!-- row -->
      </fieldset>
    </div> <!-- container -->
  </section>

  <section id="console_page" style="display:none">
    <div class="container-fluid">
      <fieldset>
        <legend>Console</legend>
        <h3>Command</h3>
        <pre id="execute"></pre>
        <div id="response" style="display:none">
          <h3>Return code ($?)</h3>
          <pre id="rc"></pre>
          <h3>Output (stdout)</h3> <!--  <small><button class="btn btn-warning">Download</button> -->
          <pre id="stdout"></pre>
          <h3>Errors (stderr)</h3>
          <pre id="stderr"></pre>
        </div>
      </fieldset>
    </div> <!-- container -->
  </section>

  <section id="banner">
    <div class="container">
      <div class="alert alert-info alert-dismissible" role="alert">
        <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <p><b>CLI Explorer</b> runs with any OpenStack cloud including <a href="http://docs.openstack.org/developer/devstack/">devstack</a>.</p>
        <p>All you need is the necessary credentials used to access your Horizon Dashboard and your Identity API Endpoint which you can find under the <b>Access & Security</b> menu option and <b>API Access</b> tab.</p>
        <p>Try <a href="http://opentstack.org">OpenStack</a> free for 12 months with <a target="_blank" href="https://express.mirantis.com">Mirantis Express</a>. You can then use <b>CLI Explorer</b> to learn the commands to manage your cloud.</p>
        <p></p>
      </div> <!-- alert -->
    </div> <!-- container -->
  </section>

  <footer>
    <div class="container">
      <div class="row text-center">
        <ul class="list-inline">
          <li><a target="_blank" href="https://github.com/ronaldbradford/cli_explorer">View this code</a></li>
          <li><a target="_blank" href="http://docs.openstack.org/developer/python-openstackclient/">OpenStackClient (OSC) Docs</a></li>
        </ul>
      </div> <!-- row -->
      <div class="row text-center copyright">
         <a target="_blank" href="http://cli_explorer.ronaldbradford.com">CLI Explorer</a> is developed by <a href="http://ronaldbradford.com/">Ronald Bradford</a>. 
         Created in 2015.
      </div> <!-- row -->
    </div> <!-- container -->
  </footer>
</body>

<!-- CDN
<script type="text/javascript" src="//code.jquery.com/jquery-2.1.3.min.js"></script>
<script type="text/javascript" src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
<script type="text/javascript" src="//cdn.jsdelivr.net/jquery.validation/1.13.1/jquery.validate.min.js"></script>
-->
<script type="text/javascript" src="m/j/jquery-2.1.3.min.js"></script>
<script type="text/javascript" src="m/j/bootstrap.min.js"></script>
<script type="text/javascript">

// General Functions
function debugging(o) {
  console.log(JSON.stringify(o));
}

function show_explorer_page(el) {
  if (el) {
    $(el).closest('section').hide();
  }

  if (os && os.explorer) {
    $('#explorer_page select[name=command]').val(os.explorer['command']);
    $('#explorer_page select[name=action]').val(os.explorer['action']);
    $('#explorer_page input[name=help]').prop('checked', (os.explorer['help'] == 'help'));
    $('#explorer_page input[name=options]').val(os.explorer['options']);
  }
  $('#explorer_page').show();
  return false;
}

var os = new Object();

function load_parameters() {
  console.log("Loading saved parameters");
  if (typeof(Storage) !== "undefined") {
    json = localStorage.getItem("cli_osc");
    if (json) {
      console.log("Retrieved parameters " + json);
      os = JSON.parse(json);
    }
  }
}


function save_parameters() {
  if (typeof(Storage) !== "undefined") {
    localStorage.setItem("cli_osc", JSON.stringify(os));
  }
}

// Navigation/Display Sections
$('.authentication').click(function() {
  console.log('.authentication');
  $('#explorer_page').hide();
  $('#console_page').hide();
  if (os && os.authentication) {
    $('#authentication_page input[name=os-username]').val(os.authentication['os-username']);
    $('#authentication_page input[name=os-password]').val(os.authentication['os-password']);
    $('#authentication_page input[name=os-project-name]').val(os.authentication['os-project-name']);
    $('#authentication_page input[name=os-auth-url]').val(os.authentication['os-auth-url']);
  }
  $('#authentication_page').show();
  return false;
});

$('.logging').click(function() {
  console.log('.logging');
  $('#explorer_page').hide();
  $('#console_page').hide();
  if (os && os.logging) {
    $('#logging_page select[name=logging]').val(os.logging['logging']);
  }
  $('#logging_page').show();
  return false;
});

$('.format').click(function() {
  console.log('.format');
  $('#explorer_page').hide();
  $('#console_page').hide();
  if (os && os.format) {
    $('#format_page select[name=format]').val(os.format['format']);
    $('#format_page input[name=prefix]').val(os.format['prefix']);
    $('#format_page input[name=long]').prop('checked', os.format['long']);
  }
  $('#format_page').show();
  return false;
});

$('.clear').click(function() {
  console.log('.clear');
  $('#msg').text('').hide();
  $('#rc').text('');
  $('#stdout').text('');
  $('#stderr').text('');
  $('#console_page').hide();
  $('#explorer_page input[name=help]').prop('checked', false);
  $('#explorer_page select[name=command]').val('');
  $('#explorer_page select[name=action]').val('');
  $('#explorer_page input[name=options]').val('');
  return false;
});

$('.explorer').click(function() {
  console.log('.explorer');
  $('#explorer_page').show();
  $('#authentication_page').hide();
  return false;
});

// Form Button Management
$('#authentication_page .save').click(function() {
  console.log('#authentication_page.save');
  $('#banner').hide();
  
  authentication = new Object();
  authentication['os-username'] = $('#authentication_page input[name=os-username]').val();
  authentication['os-password'] = $('#authentication_page input[name=os-password]').val();
  authentication['os-project-name'] = $('#authentication_page input[name=os-project-name]').val();
  authentication['os-auth-url'] = $('#authentication_page input[name=os-auth-url]').val();
  os['authentication'] = authentication;

  debugging(os);
  show_explorer_page($(this));
  return false;
});

$('#authentication_page .test').click(function() {
  console.log('#authentication_page.test');
  $('#banner').hide();
  $('#msg2').hide();
  option = $(this).text();
  
  auth_url = $('#authentication_page input[name=os-auth-url]').val();
  //TODO IF url does not have trailing / add it
  username = $('#authentication_page input[name=os-username]').val();
  password = $('#authentication_page input[name=os-password]').val();
  project_name = $('#authentication_page input[name=os-project-name]').val();

  cli = 'curl';
  args ='-sL ';
  if (option == 'Test URL') {
    args += auth_url;
  } else if (option == 'Test Values') {
    args  = '-H "Content-Type:application/json" -X POST ';
    args += '-d \'{"auth":{"tenantName":"' + project_name + '","passwordCredentials":{"username":"' + username + '","password":"' + password + '"}}}\'';
    args += ' ' + auth_url + '/tokens';
  }

  execute = cli + " " + args;
  console.log('Executing ' + execute);

  $('#console_page').show();
  $('#response').hide();
  $('#execute').text(execute);
  $('#rc').text('');
  $('#stdout').text('');
  $('#stderr').text('');

  url = 'http://localhost:4242/api/cli';
  data = "command=" + cli +  "&args=" + args;
  console.log(url + " " + data);
  $('#msg2-text').text('Running command');
  $('#msg2').removeClass('alert-warning').removeClass('alert-danger').addClass('alert-success').show();

  $.ajax({
    method: 'POST',
    url:  url,
    data: data,
    dataType: 'json', // Response
    success: function(data, textStatus, jQxhr){
      if (data && data.error) {
        console.log(data.error);
        $('#msg2-text').text(data.error);
        $('#msg2').removeClass('alert-warning').removeClass('alert-success').addClass('alert-danger').show();
      }
      else {
        $('#msg2-text').text('Successfully ran command.');
        $('#msg2').removeClass('alert-warning').removeClass('alert-danger').addClass('alert-success').show().fadeOut(2000);
        $('#rc').text(data.status);
        console.log(data.stdout);
        $('#stdout').text(JSON.stringify(JSON.parse(data.stdout),null,4));
        $('#stderr').text(data.stderr);
      }
    },
 
    error: function(jqXhr, textStatus, errorThrown ){
      $('#msg2-text').text('Error executing the command with web API.');
      $('#msg2').removeClass('alert-warning').removeClass('alert-success').addClass('alert-danger').show();
      console.log("Error executing API call");
    }
  });

  $('#response').show();

  return false;
});

$('#logging_page .save').click(function() {
  console.log('#logging_page.save');

  logging = new Object();
  logging['logging'] = $('#logging_page select[name=logging]').val();
  os['logging'] = logging;

  debugging(os);
  show_explorer_page($(this));
  return false;
});

$('#format_page .save').click(function() {
  console.log('#format_page.save');

  format = new Object();
  format['format'] = $('#format_page select[name=format]').val();
  format['prefix'] = $('#format_page input[name=prefix]').val();
  format['long'] = $('#format_page input[name=long]:checked').val();
  os['format'] = format;

  debugging(os);
  show_explorer_page($(this));
  return false;
});

$('.cancel').click(function() {
  console.log('.cancel');
  $('#console_page').hide();
  show_explorer_page($(this));
  return false;
});

$('#explorer_page .run').click(function() {
  console.log('#explorer_page.run');
  $('#msg').hide();
  $('#banner').hide();
  command = $('#explorer_page select[name=command]').val();
  action = $('#explorer_page select[name=action]').val();
  
  msg='';
  if (command == '') {
    msg = 'You need to specify a command.';
  }
  if (action == '') {
    msg += 'You need to specify an action.';
  }
  if (msg != '') {
    $('#msg-text').text(msg);
    $('#msg').addClass('alert-warning').show();
    return false;
  }

  cli = 'openstack';
  args='';
  // Add the authentication options as --[name]=value 
  for (var key in os.authentication) {
    if (os.authentication[key]) {
      args += " --" + key + "=" + os.authentication[key];
    }
  }

  // Add the logging options as value
  for (var key in os.logging) {
    if (os.logging[key]) {
      args += " " + os.logging[key];
    }
  }

  help = $('#explorer_page input[name=help]:checked').val();
  if (help) {
    args += " " + help;
  }

  // Add in the command and action
  if (args) 
    args += " "

  args += command + " " + action;

  // Add the formatting options 
  output_format="";
  for (var key in os.format) {
    if (os.format[key]) {
      args += " " + os.format[key];
    }
    if (key == "format")
      output_format=os.format[key];
  }


  options = $('#explorer_page input[name=options]').val();
  if (options)
    args += " " + options;

  args = args.trim();
  
  execute = cli + " " + args;

  explorer = new Object();
  explorer['command'] = command;
  explorer['action'] = action;
  explorer['options'] = options;
  explorer['help'] = help;
  os['explorer'] = explorer;

  save_parameters();
  $('#console_page').hide();
  $('#execute').text(execute);
  $('#rc').text('');
  $('#stdout').text('');
  $('#stderr').text('');
  console.log('Executing ' + execute);

  url = 'http://localhost:4242/api/cli';
  data = "command=" + cli +  "&args=" + args;
  console.log(url + " " + data);

  $('#msg-text').text('Running command');
  $('#msg').removeClass('alert-warning').removeClass('alert-danger').addClass('alert-success').show();

  $.ajax({
    method: 'POST',
    url:  url,
    data: data, 
    dataType: 'json', // Response
    success: function(data, textStatus, jQxhr){
      if (data && data.error) {
        console.log(data.error);
        $('#msg-text').text(data.error);
        $('#msg').removeClass('alert-warning').removeClass('alert-success').addClass('alert-danger').show();
      }
      else {
        $('#rc').text(data.status);
        console.log(data.stdout);
        stdout=data.stdout;
        if (output_format == "-f json")
          stdout = JSON.stringify(JSON.parse(data.stdout),null,4);
        $('#stdout').text(stdout)
        $('#stderr').text(data.stderr);
        if (data.stderr) {
          $('#msg-text').text('WARNNG: stderr found running command.');
          $('#msg').removeClass('alert-success').removeClass('alert-danger').addClass('alert-warning').show();
        } else {
          $('#msg-text').text('Successfully ran command.');
          $('#msg').removeClass('alert-warning').removeClass('alert-danger').addClass('alert-success').show().fadeOut(2000);
        }
       
        $('#console_page').show();
      }
    },
    error: function(jqXhr, textStatus, errorThrown ){
      $('#msg-text').text('Error executing the command with web API.');
      $('#msg').removeClass('alert-warning').removeClass('alert-success').addClass('alert-danger').show();
      console.log("Error executing API call");
    }
  });

  $('#response').show();
  return false;
});

// Page Initialization
$(document).ready(function() {
  load_parameters();
  show_explorer_page();
}); //document.ready

</script>
</html>
